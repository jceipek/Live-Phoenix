<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"><html>
	<head>
		<title>Live Phoenix</title>
	</head>
	<link rel="stylesheet" type="text/css" href="style.css" media="screen" />
  <link rel="stylesheet" type="text/css" href="jqcloud.css" media="screen" />
	<script src="lib/jquery.js"></script>
  <script src="js/jquery-ui-1.9.0.custom.js"></script>
  <script src="lib/d3.v2.min.js"></script>
  <script src="lib/d3.layout.cloud.js"></script>
<script src="lib/jquery.timeago.js" type="text/javascript"></script>
  <script src="lib/jqcloud-1.0.2.min.js"></script>
	<script type='text/javascript'>
		$(document).ready(function(){
        var searchType = "%23"; //%40 for @, %23 for #
        var searchParam = "david";
        var numToCycle = 10;
        var wordCloudList = [];
        
        window.questions = ["what is your club doing?",
   	    										"what interests you?",
   	    										"what are you working on?",
   	    										"why are you happy today?",
   	    										"what makes olin awesome?"];
            
            function flipText(newText) {
                flipUp == true ? ($("#new-text").text(newText), $("#old-text").hide("drop", {
                    direction: "down"
                }, 300), $("#new-text").show("drop", {
                    direction: "up"
                }, 300)) : ($("#old-text").text(newText), $("#old-text").show("drop", {
                    direction: "up"
                }, 300), $("#new-text").hide("drop", {
                    direction: "down"
                }, 300));
                flipUp = !flipUp; // Alternating flipping direction
            }
        
            var interval = 4e3; // 4 seconds
            var flipUp = true;
            var index = 0;
            var maxIndex = window.questions.length - 1;
            setInterval(function() {
                var nextText = window.questions[index];
                flipText(nextText);
                index = (index == maxIndex) ? 0 : index + 1;
             }, interval);
   	 
        var CardDeck = function(anchor){
          this.anchor = anchor;
          this.minPos = -1000;
          this.maxPos = -1000;
          var rotationSize = 1300;
          this.firstIndex = 0;
          this.cards = new Array();

          this.rotateCards = function(){
          	
            var that = this;
            // add everything by the rotation size each time
            this.cards.forEach(function(card, index){
              // rotate the first card to the back
//              console.log(index,that.firstIndex)
              if (index == that.firstIndex) {
                card.firstCardSmoothTransition(that.maxPos-rotationSize);
              } else {
                card.updatePositionWithAnimation(card.position-rotationSize);
              }
            });
            if (that.firstIndex == (that.cards.length-1)) {
              that.firstIndex = -1;
            }
            that.firstIndex += 1;
          }

          this.addCard = function(card){
            if (this.cards.length == 0){
              card.isFirst = true;
            }
            card.create(this.anchor);
            card.updatePosition(this.maxPos);
            this.cards.push(card);
            this.maxPos += rotationSize;
          }

          this.removeCard = function(position){
            this.cards.splice(position, 1);
          }
        }
        var cards = new CardDeck($('#cards'));

        var Card = function(text, created_at, from_user_name, from_user, profile_image_url){
          this.obj;
					
          this.position = 0;
          this.updatePositionWithAnimation = function(position){
            this.position = position;
            this.obj.animate({'margin-left': this.position},1500);
          }
          this.updatePosition = function(position){
            this.position = position;
            this.obj.css('margin-left', this.position);
          }
          this.firstCardSmoothTransition = function(position){
            this.position = position;
            this.obj.animate({'margin-left': -914},800,function(that) {return function(){
                that.obj.css('margin-left', position);
            }}(this));
          }

          this.create = function(anchor){
            this.obj = ($('<div>')
              .attr('class', 'card').css('margin-left', 0 )).append($('<div>')
                .attr('class', 'author_info').append($('<div>')
                  .attr('class', 'avatar').append($('<span>')
                    .attr('class', 'frame'))
                  .append($('<img>').attr('class', 'profile_pic').attr('src', profile_image_url)
                    )
                  )
                .append($('<p>').attr('class', 'name').text(from_user_name))
                .append($('<p>').attr('class', 'handle').text("@"+from_user))
                .append($('<p>').attr('class', 'timestamp').text(jQuery.timeago(created_at))))
              .append($('<div>').attr('class', 'tweet').text(text));
            anchor.append(this.obj);
          }
          
        }

        cards = new CardDeck($('#cards'));
				
        // fetching api
        $.get('http://search.twitter.com/search.json?rpp='+numToCycle+'&q='+searchType+searchParam, 
          function(data){
            var tweets = data.results;
            tweets.forEach(function(tweet, index){
              // create a card for each one
              var card = new Card(tweet.text, tweet.created_at, tweet.from_user_name, tweet.from_user, tweet.profile_image_url.replace("_normal", ""));

              wordCloudList = wordCloudList.filter(function(element, index, array) {
                return index==array.indexOf(element) && element != searchType+searchParam;
              });
//              console.log(wordCloudList);
              cards.addCard(card);
            });
            // generateWordCloud();
          }, 'json');

        var ColorCycle = function(){
          var colors = ['#545454', '#636363', '#707070', '#808080'];
          var index = 1;

          this.getColor = function() {
            var color = colors[index-1];
            if (index == colors.length) {
              index = 1;
            } else {
              index++;
            }
            return color;
          }
        }

        setInterval(function() {cards.rotateCards()}, 5000);

        // function generateWordCloud() {
        //   $(function() {
        //     $("#wordcloud").jQCloud(wordCloudList.map(function(element){
        //       return {text: element, weight: Math.random() * 10};
        //     }), {shape: "rectangular"});
        //   });
        // }

//        function generateWordCloud() {
          // word cloud
//          var color = new ColorCycle();
//          var wordCloudList = ["Hello", "world", "normally", "you", "want", "more", "words",
//        "than", "this", "Hello", "world", "normally", "you", "want", "more", "words",
//        "than"];
//          var width = 1400;
//          var height = 150;
//          d3.layout.cloud().size([width, height])
            // .text(function(d) { return d.key; })
            // .size(function(d) { return 10; })
//            .words(
//              wordCloudList.map(function(d) {
//              return {text: d, size: 30};
//            }))
//            .rotate(function() { return 0;}) // ~~(Math.random() * 2) * 90;
//            .fontSize(function(d) { return d.size; })
//            .on("end", draw)
//            .start();
//
//          function draw(words) {
//            d3.select("#wordcloud").append("svg")
//                .attr("width", width)
//                .attr("height", height)
//              .append("g")
//                .attr("transform", "translate("+width/2+","+(height/2+10)+")")
//              .selectAll("text")
//                .data(words)
//              .enter().append("text")
                // .style("font-family", function(d) {return "Impact"} )
//                .style("font-size", function(d) { return d.size + "px"; })
//                .style("fill", function(d) { return color.getColor(); })
//                .attr("text-anchor", "middle")
//                .attr("transform", function(d) {
//                  return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
//                })
//                .text(function(d) { return d.text; });
//          }
//        }
     });
	</script>
	<body>
		<div id="header">
			<div id="instructions">
				<span id="bird_icon"></span>Tweet with #livephoenix
			</div>
			
			<div id="questions">
		  	<span id="dynamic-text-wrapper">
		  	        <span id="old-text"></span>
		  	        <span id="new-text"></span>
		  	 </span>
			</div>
		</div>
		
		<div id="cards">
		</div>

	</body>
</html>
